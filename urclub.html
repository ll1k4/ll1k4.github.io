<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß–∞—Ç —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        
        #app {
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .coins {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
        }
        
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 15px;
            border-right: 1px solid #e5e7eb;
        }
        
        .chat-window {
            flex: 1;
            overflow-y: auto;
            background-color: #f9fafb;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e5e7eb;
        }
        
        .message {
            background-color: white;
            border-radius: 12px;
            padding: 10px 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #4f46e5;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }
        
        .username {
            font-weight: 600;
            color: #4f46e5;
        }
        
        .time {
            color: #9ca3af;
        }
        
        .message-content {
            color: #374151;
            line-height: 1.4;
        }
        
        .online-users {
            width: 250px;
            padding: 15px;
            background-color: #f9fafb;
            overflow-y: auto;
            border-left: 1px solid #e5e7eb;
        }
        
        .online-users h3 {
            margin-bottom: 15px;
            color: #374151;
            font-size: 1.2rem;
            padding-bottom: 10px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .user-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 8px;
            background-color: white;
            border: 1px solid #e5e7eb;
        }
        
        .user-item.active {
            border-color: #4f46e5;
            background-color: #eef2ff;
        }
        
        .character-preview {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            position: relative;
        }
        
        .character-body {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .character-eyes {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .character-clothes {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: contain;
            z-index: 2;
        }
        
        .user-name {
            font-weight: 500;
            color: #374151;
        }
        
        .stage-area {
            height: 200px;
            background-color: #f1f5f9;
            border-radius: 12px;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
            border: 1px solid #cbd5e1;
        }
        
        .character-on-stage {
            position: absolute;
            width: 80px;
            height: 80px;
            cursor: pointer;
            transition: transform 0.2s;
            z-index: 5;
        }
        
        .character-on-stage:hover {
            transform: scale(1.05);
        }
        
        .input-area {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .message-input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 12px;
            border: 1px solid #d1d5db;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .message-input:focus {
            border-color: #4f46e5;
        }
        
        .btn {
            padding: 12px 20px;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }
        
        .btn-shop {
            background: linear-gradient(90deg, #059669, #10b981);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            font-size: 1.5rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .close-modal:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .shop-content {
            padding: 20px;
            display: flex;
            gap: 20px;
        }
        
        .shop-items {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            max-height: 50vh;
            overflow-y: auto;
        }
        
        .shop-item {
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .shop-item:hover {
            transform: translateY(-5px);
            border-color: #4f46e5;
        }
        
        .shop-item.selected {
            border-color: #10b981;
        }
        
        .shop-item-image {
            width: 100%;
            height: 120px;
            object-fit: contain;
            background-color: #f9fafb;
            padding: 10px;
        }
        
        .shop-item-info {
            padding: 10px;
            background-color: white;
        }
        
        .shop-item-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #374151;
        }
        
        .shop-item-price {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .price {
            color: #059669;
            font-weight: 600;
        }
        
        .shop-sidebar {
            width: 200px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .salary-btn {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .salary-btn:hover {
            transform: translateY(-3px);
        }
        
        .salary-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .character-preview-large {
            width: 100%;
            height: 180px;
            position: relative;
            background-color: #f9fafb;
            border-radius: 12px;
            margin-top: 10px;
        }
        
        .setup-modal {
            max-width: 500px;
        }
        
        .setup-content {
            padding: 30px;
        }
        
        .setup-step {
            margin-bottom: 25px;
        }
        
        .setup-step h3 {
            margin-bottom: 15px;
            color: #374151;
        }
        
        .gender-selector {
            display: flex;
            gap: 15px;
        }
        
        .gender-option {
            flex: 1;
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .gender-option:hover {
            border-color: #4f46e5;
        }
        
        .gender-option.selected {
            border-color: #4f46e5;
            background-color: #eef2ff;
        }
        
        .gender-preview {
            width: 100px;
            height: 100px;
            margin: 0 auto 10px;
            position: relative;
        }
        
        .eyes-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .eye-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            padding: 5px;
            transition: all 0.2s;
        }
        
        .eye-option.selected {
            border-color: #4f46e5;
        }
        
        .eye-option img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .username-input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 12px;
            border: 1px solid #d1d5db;
            font-size: 1rem;
            margin-top: 10px;
        }
        
        .setup-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .online-users {
                width: 100%;
                height: 150px;
                border-left: none;
                border-top: 1px solid #e5e7eb;
            }
            
            .shop-content {
                flex-direction: column;
            }
            
            .shop-sidebar {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ) -->
        <div id="setupModal" class="modal active">
            <div class="modal-content setup-modal">
                <div class="modal-header">
                    <h2>–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h2>
                </div>
                <div class="setup-content">
                    <div class="setup-step">
                        <h3>1. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h3>
                        <div class="gender-selector">
                            <div class="gender-option" data-gender="male">
                                <div class="gender-preview">
                                    <img src="https://drive.google.com/uc?export=view&id=1ia3KY762uHxblkqCJr6y0xd1NEmEZNWY" alt="–ú—É–∂—Å–∫–æ–µ —Ç–µ–ª–æ" class="character-body">
                                </div>
                                <div>–ú—É–∂—Å–∫–æ–π</div>
                            </div>
                            <div class="gender-option" data-gender="female">
                                <div class="gender-preview">
                                    <img src="https://drive.google.com/uc?export=view&id=1khsTyJEWR1omUhoGqiMT9deiGz6rHnza" alt="–ñ–µ–Ω—Å–∫–æ–µ —Ç–µ–ª–æ" class="character-body">
                                </div>
                                <div>–ñ–µ–Ω—Å–∫–∏–π</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <h3>2. –í—ã–±–µ—Ä–∏—Ç–µ –≥–ª–∞–∑–∞</h3>
                        <div class="eyes-selector">
                            <div class="eye-option selected" data-eyes="blue">
                                <img src="https://drive.google.com/uc?export=view&id=1xZiEJQZevtezY6b8AtTKw_DTxAnlcKRK" alt="–ì–æ–ª—É–±—ã–µ –≥–ª–∞–∑–∞">
                            </div>
                            <div class="eye-option" data-eyes="blue2">
                                <img src="https://drive.google.com/uc?export=view&id=1IlujVhwrFqg5J-uBsSikk1-7VjSZ2C6M" alt="–ì–æ–ª—É–±—ã–µ –≥–ª–∞–∑–∞ (–∂–µ–Ω—Å–∫–∏–µ)">
                            </div>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <h3>3. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫</h3>
                        <input type="text" id="usernameInput" class="username-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫–Ω–µ–π–º" maxlength="20">
                    </div>
                    
                    <div class="setup-buttons">
                        <button id="saveCharacter" class="btn">–í–æ–π—Ç–∏ –≤ —á–∞—Ç</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ú–∞–≥–∞–∑–∏–Ω -->
        <div id="shopModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>–ú–∞–≥–∞–∑–∏–Ω –æ–¥–µ–∂–¥—ã</h2>
                    <button class="close-modal" id="closeShop">&times;</button>
                </div>
                <div class="shop-content">
                    <div class="shop-items" id="shopItems">
                        <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                    <div class="shop-sidebar">
                        <button class="salary-btn" id="salaryButton">
                            <div>–ó–∞—Ä–ø–ª–∞—Ç–∞</div>
                            <div>+8 –º–æ–Ω–µ—Ç</div>
                            <div id="salaryTimer">–î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å</div>
                        </button>
                        
                        <div class="character-preview-large" id="shopPreview">
                            <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å –æ–¥–µ–∂–¥–æ–π -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
        <div class="header">
            <h1>–ß–∞—Ç —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏</h1>
            <div class="user-info">
                <div class="coins">
                    <span id="coinsCount">100</span> <span>ü™ô</span>
                </div>
                <div id="currentUser">–ì–æ—Å—Ç—å</div>
            </div>
        </div>
        
        <div class="main-container">
            <div class="chat-section">
                <div class="chat-window" id="chatWindow">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                    <div class="message">
                        <div class="message-header">
                            <span class="username">–°–∏—Å—Ç–µ–º–∞</span>
                            <span class="time">–¢–æ–ª—å–∫–æ —á—Ç–æ</span>
                        </div>
                        <div class="message-content">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç! –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–∞—Ç—å—Å—è —Å –¥—Ä—É–≥–∏–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏.</div>
                    </div>
                </div>
                
                <div class="stage-area" id="stageArea">
                    <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
                
                <div class="input-area">
                    <input type="text" class="message-input" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                    <button class="btn" id="sendButton">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    <button class="btn btn-shop" id="shopButton">–ú–∞–≥–∞–∑–∏–Ω</button>
                </div>
            </div>
            
            <div class="online-users">
                <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏ –æ–Ω–ª–∞–π–Ω</h3>
                <div id="onlineUsersList">
                    <!-- –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            const tg = window.Telegram.WebApp;
            tg.expand();
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            const setupModal = document.getElementById('setupModal');
            const shopModal = document.getElementById('shopModal');
            const closeShopBtn = document.getElementById('closeShop');
            const shopButton = document.getElementById('shopButton');
            const salaryButton = document.getElementById('salaryButton');
            const sendButton = document.getElementById('sendButton');
            const messageInput = document.getElementById('messageInput');
            const chatWindow = document.getElementById('chatWindow');
            const stageArea = document.getElementById('stageArea');
            const onlineUsersList = document.getElementById('onlineUsersList');
            const coinsCount = document.getElementById('coinsCount');
            const currentUser = document.getElementById('currentUser');
            const saveCharacterBtn = document.getElementById('saveCharacter');
            const usernameInput = document.getElementById('usernameInput');
            const shopItems = document.getElementById('shopItems');
            const shopPreview = document.getElementById('shopPreview');
            const salaryTimer = document.getElementById('salaryTimer');
            
            // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            let userData = {
                id: Date.now().toString(),
                username: '',
                gender: 'male',
                eyes: 'blue',
                coins: 100,
                clothes: [],
                position: { x: 50, y: 50 }
            };
            
            let onlineUsers = [];
            let messages = [];
            let shopItemsData = [];
            let lastSalaryTime = 0;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–∞–≥–∞–∑–∏–Ω–∞
            function initShopItems() {
                shopItemsData = [
                    { id: 1, name: '–°–∏–Ω—è—è –∫–æ—Ñ—Ç–∞', price: 30, image: 'https://i.ibb.co/4M0q3Kz/blue-hoodie.png', type: 'top', gender: 'both' },
                    { id: 2, name: '–ö—Ä–∞—Å–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞', price: 20, image: 'https://i.ibb.co/K9n5G2C/red-tshirt.png', type: 'top', gender: 'both' },
                    { id: 3, name: '–ß—ë—Ä–Ω—ã–µ —à—Ç–∞–Ω—ã', price: 25, image: 'https://i.ibb.co/9qQ0Y3W/black-pants.png', type: 'bottom', gender: 'both' },
                    { id: 4, name: '–°–∏–Ω–∏–µ –¥–∂–∏–Ω—Å—ã', price: 35, image: 'https://i.ibb.co/3s1VbqK/blue-jeans.png', type: 'bottom', gender: 'both' },
                    { id: 5, name: '–ö—Ä–∞—Å–Ω–æ–µ –ø–ª–∞—Ç—å–µ', price: 50, image: 'https://i.ibb.co/ZKZv3H4/red-dress.png', type: 'dress', gender: 'female' },
                    { id: 6, name: '–ß—ë—Ä–Ω–∞—è —é–±–∫–∞', price: 30, image: 'https://i.ibb.co/LkLprL7/black-skirt.png', type: 'bottom', gender: 'female' },
                    { id: 7, name: '–°—Ç–∏–ª—å–Ω—ã–µ –≤–æ–ª–æ—Å—ã', price: 40, image: 'https://i.ibb.co/fxFh5xW/cool-hair.png', type: 'hair', gender: 'both' },
                    { id: 8, name: '–ö–µ–ø–∫–∞', price: 15, image: 'https://i.ibb.co/Km0gP0W/cap.png', type: 'hat', gender: 'both' }
                ];
                
                renderShopItems();
            }
            
            // –†–µ–Ω–¥–µ—Ä —Ç–æ–≤–∞—Ä–æ–≤ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
            function renderShopItems() {
                shopItems.innerHTML = '';
                
                shopItemsData.forEach(item => {
                    if (item.gender === 'both' || item.gender === userData.gender) {
                        const isOwned = userData.clothes.includes(item.id);
                        const isSelected = isOwned && userData.clothes.includes(item.id);
                        
                        const itemElement = document.createElement('div');
                        itemElement.className = `shop-item ${isSelected ? 'selected' : ''}`;
                        itemElement.innerHTML = `
                            <img src="${item.image}" alt="${item.name}" class="shop-item-image">
                            <div class="shop-item-info">
                                <div class="shop-item-name">${item.name}</div>
                                <div class="shop-item-price">
                                    <span class="price">${item.price} ü™ô</span>
                                    ${isOwned ? '<span style="color: #10b981;">‚úì –ö—É–ø–ª–µ–Ω–æ</span>' : 
                                      (userData.coins >= item.price ? 
                                       '<button class="btn" style="padding: 5px 10px; font-size: 0.8rem;">–ö—É–ø–∏—Ç—å</button>' : 
                                       '<span style="color: #ef4444;">–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç</span>')}
                                </div>
                            </div>
                        `;
                        
                        if (!isOwned && userData.coins >= item.price) {
                            itemElement.querySelector('button').addEventListener('click', () => buyItem(item));
                        } else if (isOwned) {
                            itemElement.addEventListener('click', () => selectClothing(item.id));
                        }
                        
                        shopItems.appendChild(itemElement);
                    }
                });
                
                updateShopPreview();
            }
            
            // –ü–æ–∫—É–ø–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
            function buyItem(item) {
                if (userData.coins >= item.price) {
                    userData.coins -= item.price;
                    userData.clothes.push(item.id);
                    coinsCount.textContent = userData.coins;
                    saveUserData();
                    renderShopItems();
                    updateUserCharacter();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–∫—É–ø–∫–µ
                    addMessage('–°–∏—Å—Ç–µ–º–∞', `–í—ã –∫—É–ø–∏–ª–∏ "${item.name}" –∑–∞ ${item.price} –º–æ–Ω–µ—Ç!`, true);
                }
            }
            
            // –í—ã–±–æ—Ä –æ–¥–µ–∂–¥—ã –¥–ª—è –Ω–∞–¥–µ–≤–∞–Ω–∏—è
            function selectClothing(itemId) {
                // –ï—Å–ª–∏ –ø—Ä–µ–¥–º–µ—Ç —É–∂–µ –≤—ã–±—Ä–∞–Ω, —Å–Ω–∏–º–∞–µ–º –µ–≥–æ
                if (userData.clothes.includes(itemId)) {
                    const index = userData.clothes.indexOf(itemId);
                    if (index > -1) {
                        userData.clothes.splice(index, 1);
                    }
                } else {
                    // –ù–∞–¥–µ–≤–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç
                    userData.clothes.push(itemId);
                }
                
                saveUserData();
                renderShopItems();
                updateUserCharacter();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
            function updateShopPreview() {
                shopPreview.innerHTML = '';
                
                // –¢–µ–ª–æ
                const bodyUrl = userData.gender === 'male' ? 
                    'https://drive.google.com/uc?export=view&id=1ia3KY762uHxblkqCJr6y0xd1NEmEZNWY' : 
                    'https://drive.google.com/uc?export=view&id=1khsTyJEWR1omUhoGqiMT9deiGz6rHnza';
                
                const bodyImg = document.createElement('img');
                bodyImg.src = bodyUrl;
                bodyImg.className = 'character-body';
                bodyImg.style.position = 'absolute';
                bodyImg.style.width = '100%';
                bodyImg.style.height = '100%';
                bodyImg.style.objectFit = 'contain';
                shopPreview.appendChild(bodyImg);
                
                // –ì–ª–∞–∑–∞
                const eyesUrl = userData.eyes === 'blue' ? 
                    'https://drive.google.com/uc?export=view&id=1xZiEJQZevtezY6b8AtTKw_DTxAnlcKRK' : 
                    'https://drive.google.com/uc?export=view&id=1IlujVhwrFqg5J-uBsSikk1-7VjSZ2C6M';
                
                const eyesImg = document.createElement('img');
                eyesImg.src = eyesUrl;
                eyesImg.className = 'character-eyes';
                eyesImg.style.position = 'absolute';
                eyesImg.style.width = '100%';
                eyesImg.style.height = '100%';
                eyesImg.style.objectFit = 'contain';
                shopPreview.appendChild(eyesImg);
                
                // –û–¥–µ–∂–¥–∞
                userData.clothes.forEach(clothingId => {
                    const item = shopItemsData.find(i => i.id === clothingId);
                    if (item) {
                        const clothesImg = document.createElement('img');
                        clothesImg.src = item.image;
                        clothesImg.className = 'character-clothes';
                        clothesImg.style.position = 'absolute';
                        clothesImg.style.width = '100%';
                        clothesImg.style.height = '100%';
                        clothesImg.style.objectFit = 'contain';
                        shopPreview.appendChild(clothesImg);
                    }
                });
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞—Ä–ø–ª–∞—Ç—ã
            function getSalary() {
                const now = Date.now();
                const timeSinceLastSalary = now - lastSalaryTime;
                
                if (lastSalaryTime === 0 || timeSinceLastSalary >= 60000) {
                    userData.coins += 8;
                    lastSalaryTime = now;
                    coinsCount.textContent = userData.coins;
                    saveUserData();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä
                    updateSalaryTimer();
                    
                    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –º–∏–Ω—É—Ç—É
                    salaryButton.disabled = true;
                    setTimeout(() => {
                        salaryButton.disabled = false;
                        salaryTimer.textContent = '–î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å';
                    }, 60000);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    addMessage('–°–∏—Å—Ç–µ–º–∞', `–í—ã –ø–æ–ª—É—á–∏–ª–∏ –∑–∞—Ä–ø–ª–∞—Ç—É –≤ —Ä–∞–∑–º–µ—Ä–µ 8 –º–æ–Ω–µ—Ç!`, true);
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã
            function updateSalaryTimer() {
                if (lastSalaryTime === 0) {
                    salaryTimer.textContent = '–î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å';
                    return;
                }
                
                const now = Date.now();
                const timeSinceLastSalary = now - lastSalaryTime;
                const timeLeft = Math.max(0, 60000 - timeSinceLastSalary);
                
                if (timeLeft > 0) {
                    const secondsLeft = Math.ceil(timeLeft / 1000);
                    salaryTimer.textContent = `–î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ ${secondsLeft} —Å–µ–∫`;
                } else {
                    salaryTimer.textContent = '–î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å';
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            function saveUserData() {
                localStorage.setItem('chatUserData', JSON.stringify(userData));
                localStorage.setItem('lastSalaryTime', lastSalaryTime.toString());
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            function loadUserData() {
                const savedData = localStorage.getItem('chatUserData');
                const savedSalaryTime = localStorage.getItem('lastSalaryTime');
                
                if (savedData) {
                    userData = JSON.parse(savedData);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    coinsCount.textContent = userData.coins;
                    currentUser.textContent = userData.username;
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    setupModal.classList.remove('active');
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞—Ä–ø–ª–∞—Ç—ã
                    if (savedSalaryTime) {
                        lastSalaryTime = parseInt(savedSalaryTime);
                        updateSalaryTimer();
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É
                        const now = Date.now();
                        if (now - lastSalaryTime >= 60000) {
                            salaryButton.disabled = false;
                        } else {
                            salaryButton.disabled = true;
                            setTimeout(() => {
                                salaryButton.disabled = false;
                                salaryTimer.textContent = '–î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å';
                            }, 60000 - (now - lastSalaryTime));
                        }
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–Ω–ª–∞–π–Ω
                    addOnlineUser(userData);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                    updateUserCharacter();
                    
                    return true;
                }
                return false;
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ø–∏—Å–æ–∫ –æ–Ω–ª–∞–π–Ω
            function addOnlineUser(user) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                const existingIndex = onlineUsers.findIndex(u => u.id === user.id);
                
                if (existingIndex === -1) {
                    onlineUsers.push(user);
                } else {
                    onlineUsers[existingIndex] = user;
                }
                
                renderOnlineUsers();
            }
            
            // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            function renderOnlineUsers() {
                onlineUsersList.innerHTML = '';
                
                onlineUsers.forEach(user => {
                    const userElement = document.createElement('div');
                    userElement.className = `user-item ${user.id === userData.id ? 'active' : ''}`;
                    
                    // –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–≤—å—é –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                    const preview = document.createElement('div');
                    preview.className = 'character-preview';
                    
                    // –¢–µ–ª–æ
                    const bodyUrl = user.gender === 'male' ? 
                        'https://drive.google.com/uc?export=view&id=1ia3KY762uHxblkqCJr6y0xd1NEmEZNWY' : 
                        'https://drive.google.com/uc?export=view&id=1khsTyJEWR1omUhoGqiMT9deiGz6rHnza';
                    
                    const bodyImg = document.createElement('img');
                    bodyImg.src = bodyUrl;
                    bodyImg.className = 'character-body';
                    
                    // –ì–ª–∞–∑–∞
                    const eyesUrl = user.eyes === 'blue' ? 
                        'https://drive.google.com/uc?export=view&id=1xZiEJQZevtezY6b8AtTKw_DTxAnlcKRK' : 
                        'https://drive.google.com/uc?export=view&id=1IlujVhwrFqg5J-uBsSikk1-7VjSZ2C6M';
                    
                    const eyesImg = document.createElement('img');
                    eyesImg.src = eyesUrl;
                    eyesImg.className = 'character-eyes';
                    
                    // –û–¥–µ–∂–¥–∞
                    const clothesFragment = document.createDocumentFragment();
                    user.clothes.forEach(clothingId => {
                        const item = shopItemsData.find(i => i.id === clothingId);
                        if (item) {
                            const clothesImg = document.createElement('img');
                            clothesImg.src = item.image;
                            clothesImg.className = 'character-clothes';
                            clothesFragment.appendChild(clothesImg);
                        }
                    });
                    
                    preview.appendChild(bodyImg);
                    preview.appendChild(eyesImg);
                    preview.appendChild(clothesFragment);
                    
                    userElement.appendChild(preview);
                    
                    const nameElement = document.createElement('div');
                    nameElement.className = 'user-name';
                    nameElement.textContent = user.username;
                    
                    userElement.appendChild(nameElement);
                    onlineUsersList.appendChild(userElement);
                });
                
                renderCharactersOnStage();
            }
            
            // –†–µ–Ω–¥–µ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –Ω–∞ —Å—Ü–µ–Ω–µ
            function renderCharactersOnStage() {
                stageArea.innerHTML = '';
                
                onlineUsers.forEach(user => {
                    const character = document.createElement('div');
                    character.className = 'character-on-stage';
                    character.style.left = `${user.position.x}%`;
                    character.style.top = `${user.position.y}%`;
                    character.dataset.userId = user.id;
                    
                    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                    const characterContainer = document.createElement('div');
                    characterContainer.style.position = 'relative';
                    characterContainer.style.width = '100%';
                    characterContainer.style.height = '100%';
                    
                    // –¢–µ–ª–æ
                    const bodyUrl = user.gender === 'male' ? 
                        'https://drive.google.com/uc?export=view&id=1ia3KY762uHxblkqCJr6y0xd1NEmEZNWY' : 
                        'https://drive.google.com/uc?export=view&id=1khsTyJEWR1omUhoGqiMT9deiGz6rHnza';
                    
                    const bodyImg = document.createElement('img');
                    bodyImg.src = bodyUrl;
                    bodyImg.style.position = 'absolute';
                    bodyImg.style.width = '100%';
                    bodyImg.style.height = '100%';
                    bodyImg.style.objectFit = 'contain';
                    
                    // –ì–ª–∞–∑–∞
                    const eyesUrl = user.eyes === 'blue' ? 
                        'https://drive.google.com/uc?export=view&id=1xZiEJQZevtezY6b8AtTKw_DTxAnlcKRK' : 
                        'https://drive.google.com/uc?export=view&id=1IlujVhwrFqg5J-uBsSikk1-7VjSZ2C6M';
                    
                    const eyesImg = document.createElement('img');
                    eyesImg.src = eyesUrl;
                    eyesImg.style.position = 'absolute';
                    eyesImg.style.width = '100%';
                    eyesImg.style.height = '100%';
                    eyesImg.style.objectFit = 'contain';
                    
                    // –û–¥–µ–∂–¥–∞
                    const clothesFragment = document.createDocumentFragment();
                    user.clothes.forEach(clothingId => {
                        const item = shopItemsData.find(i => i.id === clothingId);
                        if (item) {
                            const clothesImg = document.createElement('img');
                            clothesImg.src = item.image;
                            clothesImg.style.position = 'absolute';
                            clothesImg.style.width = '100%';
                            clothesImg.style.height = '100%';
                            clothesImg.style.objectFit = 'contain';
                            clothesFragment.appendChild(clothesImg);
                        }
                    });
                    
                    characterContainer.appendChild(bodyImg);
                    characterContainer.appendChild(eyesImg);
                    characterContainer.appendChild(clothesFragment);
                    
                    character.appendChild(characterContainer);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–¥ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º
                    const nameLabel = document.createElement('div');
                    nameLabel.textContent = user.username;
                    nameLabel.style.position = 'absolute';
                    nameLabel.style.bottom = '-20px';
                    nameLabel.style.left = '50%';
                    nameLabel.style.transform = 'translateX(-50%)';
                    nameLabel.style.whiteSpace = 'nowrap';
                    nameLabel.style.fontSize = '12px';
                    nameLabel.style.color = '#374151';
                    nameLabel.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
                    nameLabel.style.padding = '2px 6px';
                    nameLabel.style.borderRadius = '4px';
                    
                    character.appendChild(nameLabel);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –¥–ª—è —Å–≤–æ–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                    if (user.id === userData.id) {
                        character.style.cursor = 'move';
                        
                        let isDragging = false;
                        let offsetX, offsetY;
                        
                        character.addEventListener('mousedown', startDrag);
                        character.addEventListener('touchstart', startDragTouch);
                        
                        function startDrag(e) {
                            isDragging = true;
                            const rect = character.getBoundingClientRect();
                            offsetX = e.clientX - rect.left;
                            offsetY = e.clientY - rect.top;
                            
                            document.addEventListener('mousemove', drag);
                            document.addEventListener('mouseup', stopDrag);
                            e.preventDefault();
                        }
                        
                        function startDragTouch(e) {
                            isDragging = true;
                            const touch = e.touches[0];
                            const rect = character.getBoundingClientRect();
                            offsetX = touch.clientX - rect.left;
                            offsetY = touch.clientY - rect.top;
                            
                            document.addEventListener('touchmove', dragTouch);
                            document.addEventListener('touchend', stopDrag);
                            e.preventDefault();
                        }
                        
                        function drag(e) {
                            if (!isDragging) return;
                            
                            const stageRect = stageArea.getBoundingClientRect();
                            let x = e.clientX - stageRect.left - offsetX;
                            let y = e.clientY - stageRect.top - offsetY;
                            
                            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å—Ü–µ–Ω—ã
                            x = Math.max(0, Math.min(x, stageRect.width - character.offsetWidth));
                            y = Math.max(0, Math.min(y, stageRect.height - character.offsetHeight));
                            
                            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –ø—Ä–æ—Ü–µ–Ω—Ç—ã
                            const percentX = (x / stageRect.width) * 100;
                            const percentY = (y / stageRect.height) * 100;
                            
                            character.style.left = `${percentX}%`;
                            character.style.top = `${percentY}%`;
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                            userData.position = { x: percentX, y: percentY };
                            saveUserData();
                        }
                        
                        function dragTouch(e) {
                            if (!isDragging) return;
                            
                            const touch = e.touches[0];
                            const stageRect = stageArea.getBoundingClientRect();
                            let x = touch.clientX - stageRect.left - offsetX;
                            let y = touch.clientY - stageRect.top - offsetY;
                            
                            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å—Ü–µ–Ω—ã
                            x = Math.max(0, Math.min(x, stageRect.width - character.offsetWidth));
                            y = Math.max(0, Math.min(y, stageRect.height - character.offsetHeight));
                            
                            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –ø—Ä–æ—Ü–µ–Ω—Ç—ã
                            const percentX = (x / stageRect.width) * 100;
                            const percentY = (y / stageRect.height) * 100;
                            
                            character.style.left = `${percentX}%`;
                            character.style.top = `${percentY}%`;
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                            userData.position = { x: percentX, y: percentY };
                            saveUserData();
                        }
                        
                        function stopDrag() {
                            isDragging = false;
                            document.removeEventListener('mousemove', drag);
                            document.removeEventListener('touchmove', dragTouch);
                            document.removeEventListener('mouseup', stopDrag);
                            document.removeEventListener('touchend', stopDrag);
                        }
                    }
                    
                    stageArea.appendChild(character);
                });
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            function updateUserCharacter() {
                addOnlineUser(userData);
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
            function addMessage(username, text, isSystem = false) {
                const message = {
                    id: Date.now().toString(),
                    username,
                    text,
                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    isSystem
                };
                
                messages.push(message);
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
                if (messages.length > 100) {
                    messages = messages.slice(-100);
                }
                
                renderMessages();
            }
            
            // –†–µ–Ω–¥–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
            function renderMessages() {
                chatWindow.innerHTML = '';
                
                messages.forEach(message => {
                    const messageElement = document.createElement('div');
                    messageElement.className = 'message';
                    messageElement.innerHTML = `
                        <div class="message-header">
                            <span class="username" style="color: ${message.isSystem ? '#059669' : '#4f46e5'}">${message.username}</span>
                            <span class="time">${message.time}</span>
                        </div>
                        <div class="message-content">${message.text}</div>
                    `;
                    chatWindow.appendChild(messageElement);
                });
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            function sendMessage() {
                const text = messageInput.value.trim();
                
                if (text && userData.username) {
                    addMessage(userData.username, text);
                    messageInput.value = '';
                    
                    // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    messageInput.focus();
                }
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            function initApp() {
                // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const hasUserData = loadUserData();
                
                // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                if (!hasUserData) {
                    setupModal.classList.add('active');
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–ª–∞
                    document.querySelectorAll('.gender-option').forEach(option => {
                        option.addEventListener('click', function() {
                            document.querySelectorAll('.gender-option').forEach(opt => opt.classList.remove('selected'));
                            this.classList.add('selected');
                            userData.gender = this.dataset.gender;
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±–æ—Ä –≥–ª–∞–∑ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–ª–∞
                            const eyesSelector = document.querySelector('.eyes-selector');
                            if (userData.gender === 'male') {
                                eyesSelector.innerHTML = `
                                    <div class="eye-option selected" data-eyes="blue">
                                        <img src="https://drive.google.com/uc?export=view&id=1xZiEJQZevtezY6b8AtTKw_DTxAnlcKRK" alt="–ì–æ–ª—É–±—ã–µ –≥–ª–∞–∑–∞">
                                    </div>
                                `;
                                userData.eyes = 'blue';
                            } else {
                                eyesSelector.innerHTML = `
                                    <div class="eye-option selected" data-eyes="blue2">
                                        <img src="https://drive.google.com/uc?export=view&id=1IlujVhwrFqg5J-uBsSikk1-7VjSZ2C6M" alt="–ì–æ–ª—É–±—ã–µ –≥–ª–∞–∑–∞ (–∂–µ–Ω—Å–∫–∏–µ)">
                                    </div>
                                `;
                                userData.eyes = 'blue2';
                            }
                        });
                    });
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                    saveCharacterBtn.addEventListener('click', function() {
                        const username = usernameInput.value.trim();
                        
                        if (!username) {
                            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫–Ω–µ–π–º');
                            return;
                        }
                        
                        userData.username = username;
                        currentUser.textContent = username;
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                        saveUserData();
                        
                        // –°–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                        setupModal.classList.remove('active');
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–Ω–ª–∞–π–Ω
                        addOnlineUser(userData);
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                        addMessage('–°–∏—Å—Ç–µ–º–∞', `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç, ${username}!`, true);
                    });
                    
                    // –í—ã–±–∏—Ä–∞–µ–º –º—É–∂—Å–∫–æ–π –ø–æ–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    document.querySelector('.gender-option[data-gender="male"]').click();
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
                initShopItems();
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                if (!hasUserData) {
                    setTimeout(() => {
                        const testUsers = [
                            { id: 'test1', username: '–ê–ª–µ–∫—Å–µ–π', gender: 'male', eyes: 'blue', coins: 150, clothes: [1, 3], position: { x: 20, y: 30 } },
                            { id: 'test2', username: '–ú–∞—Ä–∏—è', gender: 'female', eyes: 'blue2', coins: 200, clothes: [5, 7], position: { x: 70, y: 60 } }
                        ];
                        
                        testUsers.forEach(user => addOnlineUser(user));
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                        setTimeout(() => {
                            addMessage('–ê–ª–µ–∫—Å–µ–π', '–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º! –ö–∞–∫ –¥–µ–ª–∞?');
                        }, 1000);
                        
                        setTimeout(() => {
                            addMessage('–ú–∞—Ä–∏—è', '–ü—Ä–∏–≤–µ—Ç! –í—Å—ë –æ—Ç–ª–∏—á–Ω–æ, —Ç–æ–ª—å–∫–æ —á—Ç–æ –∫—É–ø–∏–ª–∞ –Ω–æ–≤–æ–µ –ø–ª–∞—Ç—å–µ –≤ –º–∞–≥–∞–∑–∏–Ω–µ!');
                        }, 2000);
                    }, 500);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä –∑–∞—Ä–ø–ª–∞—Ç—ã –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                setInterval(updateSalaryTimer, 1000);
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            shopButton.addEventListener('click', () => {
                shopModal.classList.add('active');
                updateShopPreview();
            });
            
            closeShopBtn.addEventListener('click', () => {
                shopModal.classList.remove('active');
            });
            
            salaryButton.addEventListener('click', getSalary);
            
            sendButton.addEventListener('click', sendMessage);
            
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ñ–æ–Ω
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            initApp();
        });
    </script>
</body>
</html>